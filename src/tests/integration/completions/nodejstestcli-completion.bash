#!/bin/bash
# Bash completion script for NodeJSTestCLI (nodejstestcli)
# Auto-generated by goobits-cli

_nodejstestcli_completions() {
    local cur prev words cword
    _init_completion || return

    # Get the current CLI binary path
    local cli_bin="nodejstestcli"
    
    # Check if CLI supports completion
    if ! command -v "$cli_bin" >/dev/null 2>&1; then
        return 0
    fi
    
    # Get completion suggestions from the CLI itself
    local suggestions
    suggestions=$("$cli_bin" _completion bash "$COMP_LINE" "$COMP_POINT" 2>/dev/null)
    
    if [[ $? -eq 0 && -n "$suggestions" ]]; then
        COMPREPLY=($(compgen -W "$suggestions" -- "$cur"))
        return 0
    fi
    
    # Fallback to static completions
    case "${prev}" in
        nodejstestcli)
            # Top level commands
            local commands="init deploy server database test upgrade plugin help"
            COMPREPLY=($(compgen -W "$commands" -- "$cur"))
            return 0
            ;;
        init)
            # Options for init
            local options="--template -t --skip-install --help -h"
            COMPREPLY=($(compgen -W "$options" -- "$cur"))
            return 0
            ;;
        deploy)
            # Options for deploy
            local options="--force -f --dry-run --help -h"
            COMPREPLY=($(compgen -W "$options" -- "$cur"))
            return 0
            ;;
        server)
            # Subcommands for server
            local subcommands="start stop restart "
            COMPREPLY=($(compgen -W "$subcommands" -- "$cur"))
            return 0
            ;;
        database)
            # Subcommands for database
            local subcommands="migrate seed backup "
            COMPREPLY=($(compgen -W "$subcommands" -- "$cur"))
            return 0
            ;;
        test)
            # Options for test
            local options="--coverage --watch -w --bail --help -h"
            COMPREPLY=($(compgen -W "$options" -- "$cur"))
            return 0
            ;;
        plugin)
            local plugin_commands="list install uninstall create info help"
            COMPREPLY=($(compgen -W "$plugin_commands" -- "$cur"))
            return 0
            ;;
        upgrade)
            local upgrade_options="--check --version --pre --dry-run --help -h"
            COMPREPLY=($(compgen -W "$upgrade_options" -- "$cur"))
            return 0
            ;;
        --version|-V)
            # Don't complete after version flags
            return 0
            ;;
        --help|-h)
            # Don't complete after help flags
            return 0
            ;;
        *)
            # Global options
            local global_options="--verbose -v --config -c --help -h --version -V"
            
            # Check if we're in a subcommand context
            local i=1
            local in_subcommand=""
            while [[ $i -lt $cword ]]; do
                case "${words[$i]}" in
                    init)
                        in_subcommand="init"
                        break
                        ;;
                    deploy)
                        in_subcommand="deploy"
                        break
                        ;;
                    server)
                        in_subcommand="server"
                        break
                        ;;
                    database)
                        in_subcommand="database"
                        break
                        ;;
                    test)
                        in_subcommand="test"
                        break
                        ;;
                    plugin|upgrade)
                        in_subcommand="${words[$i]}"
                        break
                        ;;
                esac
                ((i++))
            done
            
            if [[ -n "$in_subcommand" ]]; then
                # We're in a subcommand, offer subcommand-specific options
                case "$in_subcommand" in
                    init)
                        local cmd_options="--template -t --skip-install --help -h"
                        COMPREPLY=($(compgen -W "$cmd_options" -- "$cur"))
                        ;;
                    deploy)
                        local cmd_options="--force -f --dry-run --help -h"
                        COMPREPLY=($(compgen -W "$cmd_options" -- "$cur"))
                        ;;
                    server)
                        ;;
                    database)
                        ;;
                    test)
                        local cmd_options="--coverage --watch -w --bail --help -h"
                        COMPREPLY=($(compgen -W "$cmd_options" -- "$cur"))
                        ;;
                    plugin)
                        local plugin_options="--json --global --version --type --dir --help -h"
                        COMPREPLY=($(compgen -W "$plugin_options" -- "$cur"))
                        ;;
                    upgrade)
                        local upgrade_options="--check --version --pre --dry-run --help -h"
                        COMPREPLY=($(compgen -W "$upgrade_options" -- "$cur"))
                        ;;
                esac
            else
                COMPREPLY=($(compgen -W "$global_options" -- "$cur"))
            fi
            return 0
            ;;
    esac

    # File completion for certain options
    case "${prev}" in
        --config|--file|-f)
            COMPREPLY=($(compgen -f -- "$cur"))
            return 0
            ;;
        --dir|--directory|-d)
            COMPREPLY=($(compgen -d -- "$cur"))
            return 0
            ;;
    esac

    return 0
}

# Register the completion function
complete -F _nodejstestcli_completions nodejstestcli

# Also register for common variations
complete -F _nodejstestcli_completions NodeJSTestCLI

# Support for npm global installation
if [[ -n "${NPM_CONFIG_PREFIX:-}" ]]; then
    complete -F _nodejstestcli_completions "${NPM_CONFIG_PREFIX}/bin/nodejstestcli"
fi