/**
 * Comprehensive TypeScript type definitions for {{ display_name }}
 * Auto-generated from {{ file_name }}
 */

// === Core CLI Types ===

/** Base configuration interface for all commands */
export interface BaseConfig {
  readonly [key: string]: unknown;
}

/** Command execution context */
export interface CommandContext<T = Record<string, unknown>> {
  readonly commandName: string;
  readonly args: T;
  readonly options: Record<string, unknown>;
  readonly globalOptions: GlobalOptions;
}

/** Global CLI options */
export interface GlobalOptions {
  {% if cli.options %}
  {% for option in cli.options %}
  readonly {{ option.name | replace('-', '_') }}{% if not option.required %}?{% endif %}: {{ option.type | to_ts_type }};
  {% endfor %}
  {% else %}
  readonly [key: string]: unknown;
  {% endif %}
}

// === Command-specific Types ===

{% for cmd_name, cmd_data in cli.commands.items() %}
/** Arguments for {{ cmd_name }} command */
export interface {{ cmd_name | PascalCase }}Args {
  {% if cmd_data.args %}
  {% for arg in cmd_data.args %}
  readonly {{ arg.name }}{% if not arg.required %}?{% endif %}: {% if arg.choices %}{{ arg.choices | map('tojsonstring') | join(' | ') }}{% else %}{{ arg.type | default('string') | to_ts_type }}{% endif %};
  {% endfor %}
  {% endif %}
}

/** Options for {{ cmd_name }} command */
export interface {{ cmd_name | PascalCase }}Options {
  {% if cmd_data.options %}
  {% for opt in cmd_data.options %}
  readonly {{ opt.name | replace('-', '_') }}{% if not opt.required %}?{% endif %}: {% if opt.choices %}{{ opt.choices | map('tojsonstring') | join(' | ') }}{% else %}{{ opt.type | default('string') | to_ts_type }}{% endif %};
  {% endfor %}
  {% else %}
  readonly [key: string]: unknown;
  {% endif %}
}

/** Complete context for {{ cmd_name }} command */
export interface {{ cmd_name | PascalCase }}Context extends CommandContext<{{ cmd_name | PascalCase }}Args> {
  readonly options: {{ cmd_name | PascalCase }}Options;
}

{% if cmd_data.subcommands %}
// Subcommand types for {{ cmd_name }}
{% for subcmd_name, subcmd_data in cmd_data.subcommands.items() %}
/** Arguments for {{ cmd_name }} {{ subcmd_name }} subcommand */
export interface {{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Args {
  {% if subcmd_data.args %}
  {% for arg in subcmd_data.args %}
  readonly {{ arg.name }}{% if not arg.required %}?{% endif %}: {% if arg.choices %}{{ arg.choices | map('tojsonstring') | join(' | ') }}{% else %}{{ arg.type | default('string') | to_ts_type }}{% endif %};
  {% endfor %}
  {% endif %}
}

/** Options for {{ cmd_name }} {{ subcmd_name }} subcommand */
export interface {{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Options {
  {% if subcmd_data.options %}
  {% for opt in subcmd_data.options %}
  readonly {{ opt.name | replace('-', '_') }}{% if not opt.required %}?{% endif %}: {% if opt.choices %}{{ opt.choices | map('tojsonstring') | join(' | ') }}{% else %}{{ opt.type | default('string') | to_ts_type }}{% endif %};
  {% endfor %}
  {% else %}
  readonly [key: string]: unknown;
  {% endif %}
}

/** Complete context for {{ cmd_name }} {{ subcmd_name }} subcommand */
export interface {{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Context extends CommandContext<{{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Args> {
  readonly options: {{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Options;
}
{% endfor %}
{% endif %}

{% endfor %}

// === Hook System Types ===

/** Standard command hook function signature */
export type CommandHook<TContext extends CommandContext = CommandContext> = (
  context: TContext
) => Promise<void | unknown> | void | unknown;

/** Managed command interface for lifecycle commands */
export interface ManagedCommand<TContext extends CommandContext = CommandContext> {
  execute(context: TContext): Promise<unknown>;
  start?(context: TContext): Promise<void>;
  stop?(context: TContext): Promise<void>;
  restart?(context: TContext): Promise<void>;
  status?(context: TContext): Promise<void>;
}

/** Hook registry mapping command names to their handlers */
export interface HookRegistry {
  {% for cmd_name, cmd_data in cli.commands.items() %}
  {% if cmd_data.lifecycle == "managed" %}
  {{ cmd_name }}Command?: ManagedCommand<{{ cmd_name | PascalCase }}Context>;
  {% else %}
  on{{ cmd_name | PascalCase }}?: CommandHook<{{ cmd_name | PascalCase }}Context>;
  {% endif %}
  {% if cmd_data.subcommands %}
  {% for subcmd_name, subcmd_data in cmd_data.subcommands.items() %}
  on{{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}?: CommandHook<{{ cmd_name | PascalCase }}{{ subcmd_name | PascalCase }}Context>;
  {% endfor %}
  {% endif %}
  {% endfor %}
  [key: string]: CommandHook | ManagedCommand | unknown;
}

// === Plugin System Types ===

/** Plugin registration function */
export type PluginRegistration = (program: import('commander').Command) => void;

/** Plugin module interface */
export interface PluginModule {
  register: PluginRegistration;
  default?: PluginRegistration;
}

// === Validation Types ===

/** Validation result */
export interface ValidationResult {
  readonly isValid: boolean;
  readonly errors: string[];
  readonly warnings: string[];
}

/** Validator function signature */
export type Validator<T = unknown> = (value: T) => ValidationResult | Promise<ValidationResult>;

// === Utility Types ===

/** Extract command names from CLI configuration */
export type CommandNames = keyof typeof cli.commands;

/** Make properties optional */
export type PartialBy<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;

/** Make properties required */
export type RequiredBy<T, K extends keyof T> = T & Required<Pick<T, K>>;

/** Deep readonly type */
export type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P];
};

/** Configuration schema type */
export type ConfigSchema = DeepReadonly<{
  {% if cli %}
  cli: {
    name: string;
    tagline: string;
    description?: string;
    {% if cli.options %}
    options: Array<{
      name: string;
      short?: string;
      type: string;
      desc: string;
      required?: boolean;
      default?: unknown;
      choices?: string[];
    }>;
    {% endif %}
    commands: {
      {% for cmd_name, cmd_data in cli.commands.items() %}
      {{ cmd_name }}: {
        desc: string;
        icon?: string;
        alias?: string;
        is_default?: boolean;
        lifecycle?: 'standard' | 'managed';
        {% if cmd_data.args %}
        args: Array<{
          name: string;
          type?: string;
          desc: string;
          required?: boolean;
          choices?: string[];
        }>;
        {% endif %}
        {% if cmd_data.options %}
        options: Array<{
          name: string;
          short?: string;
          type: string;
          desc: string;
          required?: boolean;
          default?: unknown;
          choices?: string[];
        }>;
        {% endif %}
        {% if cmd_data.subcommands %}
        subcommands: Record<string, unknown>;
        {% endif %}
      };
      {% endfor %}
    };
  };
  {% endif %}
  package_name: string;
  command_name: string;
  display_name: string;
  description: string;
  version: string;
  author?: string;
  license?: string;
  repository?: string;
  bugs_url?: string;
  homepage?: string;
}>;

// === Module Declarations ===

declare module 'app_hooks' {
  const hooks: HookRegistry;
  export = hooks;
}

declare module '*/app_hooks' {
  const hooks: HookRegistry;
  export = hooks;
}

declare module '*/app_hooks.js' {
  const hooks: HookRegistry;
  export = hooks;
}

// === Global Augmentations ===

declare global {
  namespace NodeJS {
    interface ProcessEnv {
      NODE_ENV?: 'development' | 'production' | 'test';
      DEBUG?: string;
      [key: string]: string | undefined;
    }
  }
}

// === Export All Types ===

export * from './decorators';
export * from './validators';
export * from './plugins';