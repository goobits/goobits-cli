/**
 * Auto-generated from {{ file_name }}
 * Main CLI implementation for {{ display_name }}
 */

import { Command } from 'commander';
import chalk from 'chalk';
import * as hooks from './src/hooks.js';

// Simple types for the CLI
interface CommandArgs {
  commandName: string;
  rawArgs?: Record<string, any>;
  [key: string]: any;
}

// Create the main program
const program = new Command();

// Main CLI setup
export function cli(): void {
  program
    .name('{{ command_name }}')
    .description('{{ description }}')
    .version('{{ version }}');

  // Define commands from configuration
  {% for cmd_name, cmd_data in cli.commands.items() %}
  program
    .command('{{ cmd_name }}')
    .description('{{ cmd_data.desc }}')
    {% if cmd_data.args %}
    {% for arg in cmd_data.args %}
    .argument('{% if arg.required %}<{{ arg.name }}>{% else %}[{{ arg.name }}]{% endif %}', '{{ arg.desc }}')
    {% endfor %}
    {% endif %}
    {% if cmd_data.options %}
    {% for opt in cmd_data.options %}
    .option('{% if opt.short %}-{{ opt.short }}, {% endif %}--{{ opt.name }}{% if opt.type != "flag" %} <{{ opt.type }}>{% endif %}', '{{ opt.desc }}'{% if opt.default is not none %}, '{{ opt.default }}'{% endif %})
    {% endfor %}
    {% endif %}
    .action(async ({% if cmd_data.args %}{{ cmd_data.args | map(attribute='name') | join(', ') }}, {% endif %}options: any) => {
      const args: CommandArgs = {
        commandName: '{{ cmd_name }}',
        rawArgs: options,
        {% if cmd_data.args %}
        {% for arg in cmd_data.args %}
        {{ arg.name }},
        {% endfor %}
        {% endif %}
      };
      
      try {
        const hookName = 'on{{ cmd_name | title | replace("-", "") }}';
        if (hooks && typeof hooks[hookName as keyof typeof hooks] === 'function') {
          await (hooks[hookName as keyof typeof hooks] as (args: CommandArgs) => Promise<void>)(args);
        } else {
          console.log(chalk.blue(`Executing {{ cmd_name }} command...`));
          {% if cmd_data.args %}
          {% for arg in cmd_data.args %}
          console.log(`  {{ arg.name }}:`, {{ arg.name }});
          {% endfor %}
          {% endif %}
          console.log('Options:', options);
        }
      } catch (error) {
        console.error(chalk.red(`Error executing {{ cmd_name }}:`), error);
        process.exit(1);
      }
    });
  {% endfor %}

  // Parse arguments
  program.parse(process.argv);
  
  // Show help if no arguments provided
  if (!process.argv.slice(2).length) {
    program.outputHelp();
  }
}

// Export for use as a module
export default cli;