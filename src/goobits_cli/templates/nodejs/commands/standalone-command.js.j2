/**
 * Standalone command file for {{ cmd_name }}
 * Place this file in your project's commands/ directory
 * 
 * Generated by goobits-cli
 */

import chalk from 'chalk';

// Try to import app hooks if available
let appHooks = null;
try {
  appHooks = await import('../app_hooks.js');
} catch (error) {
  // No hooks module found
}

export default function registerCommand(program) {
  program
    .command('{{ cmd_name }}')
    .description('{{ description | default("Custom command") }}')
    {% if alias %}
    .alias('{{ alias }}')
    {% endif %}
    {% for arg in args %}
    .argument('{% if arg.required %}<{{ arg.name }}>{% else %}[{{ arg.name }}]{% endif %}', '{{ arg.description }}')
    {% endfor %}
    {% for option in options %}
    .option('{%- if option.short %}-{{ option.short }}, {% endif %}--{{ option.name }}{% if option.type != "flag" %} <value>{% endif %}', '{{ option.description }}'{% if option.default %}, {{ option.default | tojson }}{% endif %})
    {% endfor %}
    .action(async ({% if args %}{{ args | map(attribute='name') | join(', ') }}{% if options %}, {% endif %}{% endif %}options, command) => {
      try {
        // Check for hook function
        const hookName = 'on{{ cmd_name | title | replace('-', '') }}';
        
        if (appHooks && typeof appHooks[hookName] === 'function') {
          const result = await appHooks[hookName]({
            commandName: '{{ cmd_name }}',
            {% for arg in args %}
            {{ arg.name }}: {{ arg.name }},
            {% endfor %}
            ...options,
            // Include global options
            ...(command.parent?.opts() || {})
          });
          
          return result;
        } else {
          // Default implementation
          console.log(chalk.blue('{{ cmd_name }} command executed'));
          {% if args %}
          console.log(chalk.gray('Arguments:'));
          {% for arg in args %}
          console.log(`  {{ arg.name }}: ${{{ arg.name }}}`);
          {% endfor %}
          {% endif %}
          {% if options %}
          console.log(chalk.gray('Options:'));
          {% for option in options %}
          console.log(`  {{ option.name }}: ${options.{{ option.name | replace('-', '_') }}}`);
          {% endfor %}
          {% endif %}
          
          console.log('');
          console.log(chalk.yellow(`To implement this command, export a function named '${hookName}' from app_hooks.js`));
        }
      } catch (error) {
        console.error(chalk.red(`Error in {{ cmd_name }} command: ${error.message}`));
        process.exit(1);
      }
    });
}