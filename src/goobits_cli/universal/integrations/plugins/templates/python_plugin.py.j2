# Python Plugin Template for Goobits CLI Framework
# Generated from: {{ source_config }}

"""
{{ plugin_name }} - {{ plugin_description }}

A Goobits CLI plugin that provides {{ plugin_type }} functionality.
"""

import click
from typing import Dict, Any, List, Optional
import logging

logger = logging.getLogger(__name__)

# Plugin metadata
PLUGIN_INFO = {
    'name': '{{ plugin_name }}',
    'version': '{{ plugin_version }}',
    'description': '{{ plugin_description }}',
    'author': '{{ plugin_author }}',
    'plugin_type': '{{ plugin_type }}',
    'language': 'python'
}

# Plugin configuration
PLUGIN_CONFIG = {
    'enabled': True,
    'priority': {{ plugin_priority | default(50) }},
    'dependencies': {{ plugin_dependencies | tojson }},
    'settings': {{ plugin_settings | default({}) | tojson }}
}


class {{ plugin_name | title }}Plugin:
    """Main plugin class for {{ plugin_name }}."""
    
    def __init__(self):
        """Initialize the plugin."""
        self.enabled = PLUGIN_CONFIG['enabled']
        self.priority = PLUGIN_CONFIG['priority']
        self.settings = PLUGIN_CONFIG['settings']
        
        logger.info(f"Initialized plugin: {PLUGIN_INFO['name']} v{PLUGIN_INFO['version']}")
    
    def activate(self) -> bool:
        """Activate the plugin."""
        try:
            logger.info(f"Activating plugin: {PLUGIN_INFO['name']}")
            
            {% if plugin_type == 'command' %}
            # Register commands
            self._register_commands()
            {% elif plugin_type == 'completion' %}
            # Register completion providers
            self._register_completion_providers()
            {% elif plugin_type == 'hook' %}
            # Register lifecycle hooks
            self._register_hooks()
            {% elif plugin_type == 'formatter' %}
            # Register output formatters
            self._register_formatters()
            {% elif plugin_type == 'validator' %}
            # Register input validators
            self._register_validators()
            {% endif %}
            
            self.enabled = True
            return True
            
        except Exception as e:
            logger.error(f"Error activating plugin {PLUGIN_INFO['name']}: {e}")
            return False
    
    def deactivate(self) -> bool:
        """Deactivate the plugin."""
        try:
            logger.info(f"Deactivating plugin: {PLUGIN_INFO['name']}")
            
            {% if plugin_type == 'command' %}
            # Unregister commands
            self._unregister_commands()
            {% elif plugin_type == 'completion' %}
            # Unregister completion providers
            self._unregister_completion_providers()
            {% elif plugin_type == 'hook' %}
            # Unregister lifecycle hooks
            self._unregister_hooks()
            {% elif plugin_type == 'formatter' %}
            # Unregister output formatters
            self._unregister_formatters()
            {% elif plugin_type == 'validator' %}
            # Unregister input validators
            self._unregister_validators()
            {% endif %}
            
            self.enabled = False
            return True
            
        except Exception as e:
            logger.error(f"Error deactivating plugin {PLUGIN_INFO['name']}: {e}")
            return False

    {% if plugin_type == 'command' %}
    def _register_commands(self) -> None:
        """Register plugin commands."""
        # Example command registration
        from goobits_cli.universal.completion import get_completion_registry
        
        @click.command()
        @click.option('--verbose', '-v', is_flag=True, help='Enable verbose output')
        @click.argument('args', nargs=-1)
        def {{ plugin_name }}_command(verbose: bool, args: tuple):
            """{{ plugin_description }}"""
            if verbose:
                click.echo(f"Executing {PLUGIN_INFO['name']} with args: {args}")
            
            # Plugin command logic here
            result = self._execute_command(args, verbose)
            
            if result:
                click.echo(f"✅ {PLUGIN_INFO['name']} completed successfully")
            else:
                click.echo(f"❌ {PLUGIN_INFO['name']} failed", err=True)
        
        # Register the command with the CLI
        # This would integrate with the main CLI command registration system
    
    def _unregister_commands(self) -> None:
        """Unregister plugin commands."""
        # Unregister commands from the CLI system
        pass
    
    def _execute_command(self, args: tuple, verbose: bool = False) -> bool:
        """Execute the main plugin command logic."""
        try:
            # Implement your plugin's main functionality here
            logger.info(f"Executing {PLUGIN_INFO['name']} command")
            
            # Example implementation
            if args:
                logger.info(f"Processing arguments: {args}")
            
            return True
            
        except Exception as e:
            logger.error(f"Error executing {PLUGIN_INFO['name']} command: {e}")
            return False
    
    {% elif plugin_type == 'completion' %}
    def _register_completion_providers(self) -> None:
        """Register completion providers."""
        from goobits_cli.universal.completion import get_completion_registry
        
        registry = get_completion_registry()
        provider = {{ plugin_name | title }}CompletionProvider()
        registry.register_provider(provider)
    
    def _unregister_completion_providers(self) -> None:
        """Unregister completion providers."""
        # Remove providers from completion registry
        pass
    
    {% elif plugin_type == 'hook' %}
    def _register_hooks(self) -> None:
        """Register lifecycle hooks."""
        # Register hooks with the CLI lifecycle system
        pass
    
    def _unregister_hooks(self) -> None:
        """Unregister lifecycle hooks."""
        # Remove hooks from the lifecycle system
        pass
    
    {% elif plugin_type == 'formatter' %}
    def _register_formatters(self) -> None:
        """Register output formatters."""
        # Register formatters with the output system
        pass
    
    def _unregister_formatters(self) -> None:
        """Unregister output formatters."""
        # Remove formatters from the output system
        pass
    
    {% elif plugin_type == 'validator' %}
    def _register_validators(self) -> None:
        """Register input validators."""
        # Register validators with the input system
        pass
    
    def _unregister_validators(self) -> None:
        """Unregister input validators."""
        # Remove validators from the input system
        pass
    {% endif %}

{% if plugin_type == 'completion' %}

class {{ plugin_name | title }}CompletionProvider:
    """Completion provider for {{ plugin_name }}."""
    
    def __init__(self, priority: int = 50):
        """Initialize completion provider."""
        self.priority = priority
        self.enabled = True
    
    def can_provide(self, context) -> bool:
        """Check if this provider can handle the current context."""
        # Implement your completion logic here
        return '{{ plugin_name }}' in context.current_command
    
    async def provide_completions(self, context) -> List[str]:
        """Provide completion suggestions."""
        completions = []
        
        # Implement your completion suggestions here
        if context.current_word:
            # Example: provide completions based on current word
            sample_completions = ['option1', 'option2', 'option3']
            completions = [c for c in sample_completions if c.startswith(context.current_word)]
        
        return completions
    
    def get_priority(self) -> int:
        """Get provider priority."""
        return self.priority
    
    def is_enabled(self) -> bool:
        """Check if provider is enabled."""
        return self.enabled

{% endif %}

def get_plugin_info() -> Dict[str, Any]:
    """Get plugin information."""
    return PLUGIN_INFO.copy()


def create_plugin() -> {{ plugin_name | title }}Plugin:
    """Create and return plugin instance."""
    return {{ plugin_name | title }}Plugin()


def activate_plugin() -> bool:
    """Activate the plugin (entry point for plugin system)."""
    plugin = create_plugin()
    return plugin.activate()


def deactivate_plugin() -> bool:
    """Deactivate the plugin (entry point for plugin system)."""
    plugin = create_plugin()
    return plugin.deactivate()


# Plugin entry points
__all__ = [
    '{{ plugin_name | title }}Plugin',
    'get_plugin_info',
    'create_plugin', 
    'activate_plugin',
    'deactivate_plugin',
    'PLUGIN_INFO',
    'PLUGIN_CONFIG'
]


if __name__ == '__main__':
    # Test the plugin
    plugin = create_plugin()
    print(f"Plugin: {plugin}")
    print(f"Info: {get_plugin_info()}")
    print(f"Activate: {plugin.activate()}")
    print(f"Deactivate: {plugin.deactivate()}")