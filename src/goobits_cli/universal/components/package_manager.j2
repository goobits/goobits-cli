{# Universal Package Manager Template
   
   This template generates language-specific package configuration files
   for proper distribution and dependency management.
   
   Variables expected:
   - language: Target language (python, nodejs, typescript)
   - project: Project metadata
   - installation: Installation configuration  
   - dependencies: Dependencies and extras
#}

{%- if language == 'python' -%}
# This template doesn't generate pyproject.toml as it should be maintained manually
# Instead, it provides helper functions for package management

"""
Package management utilities for {{ project.name }}
Generated by Goobits CLI Framework using Universal Templates
"""

import subprocess
import sys
from pathlib import Path
from typing import List, Dict, Optional

def get_current_version() -> str:
    """Get the current installed version"""
    try:
        import {{ (project.name or 'app') | lower | replace('-', '_') }}
        return getattr({{ (project.name or 'app') | lower | replace('-', '_') }}, '__version__', 'unknown')
    except ImportError:
        return 'not installed'

def check_dependencies() -> Dict[str, bool]:
    """Check if all dependencies are installed"""
    dependencies = {
{%- if installation.extras and installation.extras.python %}
    {%- for dep in installation.extras.python %}
        '{{ dep }}': False,
    {%- endfor %}
{%- endif %}
    }
    
    for dep in dependencies:
        try:
            __import__(dep)
            dependencies[dep] = True
        except ImportError:
            dependencies[dep] = False
    
    return dependencies

def install_from_source(development: bool = False) -> bool:
    """Install package from source"""
    try:
        cmd = [sys.executable, '-m', 'pip', 'install']
        if development:
            cmd.extend(['-e', '.'])
        else:
            cmd.append('.')
        
        result = subprocess.run(cmd, check=True)
        return result.returncode == 0
    except subprocess.CalledProcessError:
        return False

{%- elif language == 'nodejs' -%}
{
  "name": "{{ (project.name or 'app') | lower | replace(' ', '-') }}",
  "version": "{{ project.version }}",
  "description": "{{ project.description }}",
  "type": "module",
  "main": "index.js",
  "bin": {
    "{{ (project.name or 'app') | lower | replace(' ', '-') }}": "./bin/cli.js"
  },
  "scripts": {
    "test": "jest",
    "test:node": "node --test",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint .",
    "format": "prettier --write .",
    "build": "echo \"No build step required\"",
    "start": "node index.js",
    "completion:install": "node bin/cli.js completion install",
    "postinstall": "node scripts/postinstall.js || true"
  },
  "keywords": [
    "cli"{% if project.tags %},
    {% for tag in project.tags %}"{{ tag }}"{% if not loop.last %},{% endif %}
    {% endfor %}{% endif %}
  ],
  "author": "{{ project.author | default('') }}",
  "license": "{{ project.license | default('MIT') }}",
  "dependencies": {
    "commander": "^11.1.0",
    "chalk": "^5.3.0"{% if installation and installation.extras and installation.extras.npm %},
    {% for package in installation.extras.npm %}
    {% if '@' in package %}
    {% set parts = package.rsplit('@', 1) %}
    "{{ parts[0] }}": "^{{ parts[1] }}"{% else %}"{{ package }}": "latest"{% endif %}{% if not loop.last %},{% endif %}
    {% endfor %}{% endif %}
  },
  "devDependencies": {
    "eslint": "^8.57.0",
    "prettier": "^3.2.5",
    "jest": "^29.7.0",
    "jest-junit": "^16.0.0",
    "@jest/globals": "^29.7.0"
  },
  "engines": {
    "node": ">={{ installation.node_version | default('14.0.0') }}"
  },
  "files": [
    "bin/",
    "lib/",
    "completions/",
    "index.js",
    "README.md"
  ],
  "repository": {
    "type": "git",
    "url": "{{ project.repository | default('') }}"
  },
  "bugs": {
    "url": "{{ project.bugs_url | default('') }}"
  },
  "homepage": "{{ project.homepage | default('') }}"
}

{%- elif language == 'typescript' -%}
{
  "name": "{{ (project.name or 'app') | lower | replace(' ', '-') }}",
  "version": "{{ project.version }}",
  "description": "{{ project.description }}",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "bin": {
    "{{ (project.name or 'app') | lower | replace(' ', '-') }}": "./dist/bin/cli.js"
  },
  "scripts": {
    "build": "tsc && chmod +x dist/bin/cli.js",
    "build:watch": "tsc --watch",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src/**/*.ts",
    "format": "prettier --write src/**/*.ts",
    "clean": "rm -rf dist",
    "dev": "npm run build && node dist/bin/cli.js",
    "completion:install": "node dist/bin/cli.js completion install",
    "prepublishOnly": "npm run clean && npm run build"
  },
  "keywords": [
    "cli",
    "typescript"{% if project.tags %},
    {% for tag in project.tags %}"{{ tag }}"{% if not loop.last %},{% endif %}
    {% endfor %}{% endif %}
  ],
  "author": "{{ project.author | default('') }}",
  "license": "{{ project.license | default('MIT') }}",
  "dependencies": {
    "commander": "^11.1.0",
    "chalk": "^5.3.0"{% if installation and installation.extras and installation.extras.npm %},
    {% for package in installation.extras.npm %}
    {% if '@' in package %}
    {% set parts = package.rsplit('@', 1) %}
    "{{ parts[0] }}": "^{{ parts[1] }}"{% else %}"{{ package }}": "latest"{% endif %}{% if not loop.last %},{% endif %}
    {% endfor %}{% endif %}
  },
  "devDependencies": {
    "typescript": "^5.3.0",
    "@types/node": "^20.10.0",
    "eslint": "^8.57.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "prettier": "^3.2.5",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.0",
    "ts-jest": "^29.1.0"
  },
  "engines": {
    "node": ">={{ installation.node_version | default('14.0.0') }}"
  },
  "files": [
    "dist/",
    "README.md"
  ],
  "repository": {
    "type": "git",
    "url": "{{ project.repository | default('') }}"
  },
  "bugs": {
    "url": "{{ project.bugs_url | default('') }}"
  },
  "homepage": "{{ project.homepage | default('') }}"
}

{%- endif -%}