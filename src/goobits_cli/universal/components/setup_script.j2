{# Universal Setup Script Template
   
   This template generates setup scripts for project installation
   and configuration across different languages.
   
   Variables expected:
   - language: Target language
   - project: Project metadata
   - cli: CLI schema
#}

{%- if language == 'rust' -%}
#!/bin/bash
# Setup script for {{ project.display_name | default(project.package_name) }}
# Generated by Goobits CLI Framework

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Project information
PACKAGE_NAME="{{ project.package_name }}"
COMMAND_NAME="{{ project.command_name }}"
DISPLAY_NAME="{{ project.display_name | default(project.package_name) }}"

echo -e "${BLUE}Setting up ${DISPLAY_NAME}...${NC}"

# Check if Rust is installed
if ! command -v rustc &> /dev/null; then
    echo -e "${RED}Error: Rust is not installed${NC}"
    echo "Please install Rust from https://rustup.rs/"
    exit 1
fi

# Check if Cargo is installed
if ! command -v cargo &> /dev/null; then
    echo -e "${RED}Error: Cargo is not installed${NC}"
    echo "Please install Cargo (usually comes with Rust)"
    exit 1
fi

echo -e "${GREEN}✓ Rust and Cargo are installed${NC}"

# Check if Cargo.toml exists
if [ ! -f Cargo.toml ]; then
    echo -e "${YELLOW}⚠ Cargo.toml not found, creating minimal configuration...${NC}"
    cat > Cargo.toml << 'EOF'
[package]
name = "{{ project.package_name | default('cli') }}"
version = "{{ project.version | default('0.1.0') }}"
edition = "2021"

[[bin]]
name = "{{ project.command_name | default('cli') }}"
path = "src/main.rs"

[dependencies]
clap = { version = "4.4", features = ["derive", "color"] }
clap_complete = "4.4"
anyhow = "1.0"
thiserror = "1.0"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"
chrono = { version = "0.4", features = ["serde"] }
dirs = "5.0"
log = "0.4"
env_logger = "0.10"
colored = "2.0"
EOF
    echo -e "${GREEN}✓ Created Cargo.toml with essential dependencies${NC}"
fi

# Check if src/hooks.rs exists
if [ ! -f src/hooks.rs ]; then
    echo -e "${YELLOW}⚠ src/hooks.rs not found, creating stub...${NC}"
    mkdir -p src
    cat > src/hooks.rs << 'EOF'
use clap::ArgMatches;
use anyhow::Result;

// Add your command implementations here
pub fn on_default(_matches: &ArgMatches) -> Result<()> {
    println!("Command not yet implemented");
    Ok(())
}
EOF
    echo -e "${GREEN}✓ Created src/hooks.rs stub${NC}"
fi

# Build the project
echo -e "${BLUE}Building ${PACKAGE_NAME}...${NC}"
if cargo build --release; then
    echo -e "${GREEN}✓ Build completed successfully${NC}"
else
    echo -e "${RED}✗ Build failed${NC}"
    exit 1
fi

# Install the binary
echo -e "${BLUE}Installing ${COMMAND_NAME}...${NC}"
if cargo install --path .; then
    echo -e "${GREEN}✓ Installation completed successfully${NC}"
else
    echo -e "${RED}✗ Installation failed${NC}"
    exit 1
fi

# Verify installation
if command -v "$COMMAND_NAME" &> /dev/null; then
    echo -e "${GREEN}✓ ${COMMAND_NAME} is now available in your PATH${NC}"
    echo -e "${BLUE}Version: $($COMMAND_NAME --version)${NC}"
else
    echo -e "${YELLOW}⚠ ${COMMAND_NAME} was installed but is not in your PATH${NC}"
    echo "You may need to add ~/.cargo/bin to your PATH"
fi

echo -e "${GREEN}Setup complete! You can now use '${COMMAND_NAME}' command.${NC}"
echo -e "${BLUE}Run '${COMMAND_NAME} --help' to get started.${NC}"

{%- elif language == 'nodejs' -%}
#!/bin/bash
# Setup script for {{ project.display_name | default(project.package_name) }}
# Generated by Goobits CLI Framework

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Project information
PACKAGE_NAME="{{ project.package_name }}"
COMMAND_NAME="{{ project.command_name }}"
DISPLAY_NAME="{{ project.display_name | default(project.package_name) }}"

echo -e "${BLUE}Setting up ${DISPLAY_NAME}...${NC}"

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo -e "${RED}Error: Node.js is not installed${NC}"
    echo "Please install Node.js from https://nodejs.org/"
    exit 1
fi

# Check if npm is installed
if ! command -v npm &> /dev/null; then
    echo -e "${RED}Error: npm is not installed${NC}"
    echo "Please install npm (usually comes with Node.js)"
    exit 1
fi

echo -e "${GREEN}✓ Node.js and npm are installed${NC}"

# Install dependencies
echo -e "${BLUE}Installing dependencies...${NC}"
if npm install; then
    echo -e "${GREEN}✓ Dependencies installed successfully${NC}"
else
    echo -e "${RED}✗ Dependency installation failed${NC}"
    exit 1
fi

# Install globally
echo -e "${BLUE}Installing ${COMMAND_NAME} globally...${NC}"
if npm install -g .; then
    echo -e "${GREEN}✓ Installation completed successfully${NC}"
else
    echo -e "${RED}✗ Global installation failed${NC}"
    echo -e "${YELLOW}Trying to install with sudo...${NC}"
    if sudo npm install -g .; then
        echo -e "${GREEN}✓ Installation completed successfully${NC}"
    else
        echo -e "${RED}✗ Installation failed${NC}"
        exit 1
    fi
fi

# Verify installation
if command -v "$COMMAND_NAME" &> /dev/null; then
    echo -e "${GREEN}✓ ${COMMAND_NAME} is now available globally${NC}"
    echo -e "${BLUE}Version: $($COMMAND_NAME --version)${NC}"
else
    echo -e "${YELLOW}⚠ ${COMMAND_NAME} was installed but is not in your PATH${NC}"
fi

echo -e "${GREEN}Setup complete! You can now use '${COMMAND_NAME}' command.${NC}"
echo -e "${BLUE}Run '${COMMAND_NAME} --help' to get started.${NC}"

{%- elif language == 'typescript' -%}
#!/bin/bash
# Setup script for {{ project.display_name | default(project.package_name) }}
# Generated by Goobits CLI Framework

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Project information
PACKAGE_NAME="{{ project.package_name }}"
COMMAND_NAME="{{ project.command_name }}"
DISPLAY_NAME="{{ project.display_name | default(project.package_name) }}"

echo -e "${BLUE}Setting up ${DISPLAY_NAME}...${NC}"

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo -e "${RED}Error: Node.js is not installed${NC}"
    echo "Please install Node.js from https://nodejs.org/"
    exit 1
fi

# Check if npm is installed
if ! command -v npm &> /dev/null; then
    echo -e "${RED}Error: npm is not installed${NC}"
    echo "Please install npm (usually comes with Node.js)"
    exit 1
fi

echo -e "${GREEN}✓ Node.js and npm are installed${NC}"

# Install dependencies
echo -e "${BLUE}Installing dependencies...${NC}"
if npm install; then
    echo -e "${GREEN}✓ Dependencies installed successfully${NC}"
else
    echo -e "${RED}✗ Dependency installation failed${NC}"
    exit 1
fi

# Build TypeScript
echo -e "${BLUE}Building TypeScript...${NC}"
if npm run build; then
    echo -e "${GREEN}✓ TypeScript build completed successfully${NC}"
else
    echo -e "${RED}✗ TypeScript build failed${NC}"
    exit 1
fi

# Install globally
echo -e "${BLUE}Installing ${COMMAND_NAME} globally...${NC}"
if npm install -g .; then
    echo -e "${GREEN}✓ Installation completed successfully${NC}"
else
    echo -e "${RED}✗ Global installation failed${NC}"
    echo -e "${YELLOW}Trying to install with sudo...${NC}"
    if sudo npm install -g .; then
        echo -e "${GREEN}✓ Installation completed successfully${NC}"
    else
        echo -e "${RED}✗ Installation failed${NC}"
        exit 1
    fi
fi

# Verify installation
if command -v "$COMMAND_NAME" &> /dev/null; then
    echo -e "${GREEN}✓ ${COMMAND_NAME} is now available globally${NC}"
    echo -e "${BLUE}Version: $($COMMAND_NAME --version)${NC}"
else
    echo -e "${YELLOW}⚠ ${COMMAND_NAME} was installed but is not in your PATH${NC}"
fi

echo -e "${GREEN}Setup complete! You can now use '${COMMAND_NAME}' command.${NC}"
echo -e "${BLUE}Run '${COMMAND_NAME} --help' to get started.${NC}"

{%- elif language == 'python' -%}
#!/bin/bash
# Setup script for {{ project.display_name | default(project.package_name) }}
# Generated by Goobits CLI Framework

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Project information
PACKAGE_NAME="{{ project.package_name }}"
COMMAND_NAME="{{ project.command_name }}"
DISPLAY_NAME="{{ project.display_name | default(project.package_name) }}"

echo -e "${BLUE}Setting up ${DISPLAY_NAME}...${NC}"

# Check if Python is installed
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}Error: Python 3 is not installed${NC}"
    echo "Please install Python 3 from https://python.org/"
    exit 1
fi

echo -e "${GREEN}✓ Python 3 is installed${NC}"

# Check if pip is installed
if ! command -v pip3 &> /dev/null; then
    echo -e "${RED}Error: pip3 is not installed${NC}"
    echo "Please install pip3"
    exit 1
fi

echo -e "${GREEN}✓ pip3 is installed${NC}"

# Install the package
echo -e "${BLUE}Installing ${PACKAGE_NAME}...${NC}"

# Try pipx first (recommended)
if command -v pipx &> /dev/null; then
    echo -e "${BLUE}Using pipx (recommended)...${NC}"
    if pipx install .; then
        echo -e "${GREEN}✓ Installation completed successfully with pipx${NC}"
    else
        echo -e "${YELLOW}pipx installation failed, trying pip...${NC}"
        if pip3 install --user .; then
            echo -e "${GREEN}✓ Installation completed successfully with pip${NC}"
        else
            echo -e "${RED}✗ Installation failed${NC}"
            exit 1
        fi
    fi
else
    echo -e "${BLUE}Using pip (consider installing pipx for better isolation)...${NC}"
    if pip3 install --user .; then
        echo -e "${GREEN}✓ Installation completed successfully${NC}"
    else
        echo -e "${RED}✗ Installation failed${NC}"
        exit 1
    fi
fi

# Verify installation
if command -v "$COMMAND_NAME" &> /dev/null; then
    echo -e "${GREEN}✓ ${COMMAND_NAME} is now available in your PATH${NC}"
    echo -e "${BLUE}Version: $($COMMAND_NAME --version)${NC}"
else
    echo -e "${YELLOW}⚠ ${COMMAND_NAME} was installed but is not in your PATH${NC}"
    echo "You may need to add ~/.local/bin to your PATH"
fi

echo -e "${GREEN}Setup complete! You can now use '${COMMAND_NAME}' command.${NC}"
echo -e "${BLUE}Run '${COMMAND_NAME} --help' to get started.${NC}"

{%- else -%}
#!/bin/bash
# Generic setup script for {{ project.display_name | default(project.package_name) }}
# Generated by Goobits CLI Framework

echo "Setup script for {{ language }} is not yet implemented."
echo "Please refer to the README.md for manual installation instructions."

{%- endif -%}