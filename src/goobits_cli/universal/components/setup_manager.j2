{# Universal Setup Manager Template
   
   This template generates setup/installation scripts for any supported language.
   It provides robust installation, upgrade, and dependency management across platforms.
   
   Variables expected:
   - language: Target language (python, nodejs, typescript)
   - project: Project metadata
   - installation: Installation configuration
   - dependencies: System and language dependencies
#}

{%- if language == 'python' -%}
#!/bin/bash
# ============================================================================
# AUTO-GENERATED FILE - DO NOT EDIT
# Generated by Goobits CLI Framework using Universal Templates
# To regenerate this file, run: goobits build --universal-templates
# ============================================================================

set -e

# Performance optimizations
export LC_ALL=C
export LANG=C
export PYTHONDONTWRITEBYTECODE=1

# Core configuration
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly PROJECT_DIR="$SCRIPT_DIR"
readonly PACKAGE_NAME="{{ installation.pypi_name or ((project.name or 'app') | lower | replace('-', '_')) }}"
readonly COMMAND_NAME="{{ (project.name or 'app') | lower | replace(' ', '-') }}"
readonly DISPLAY_NAME="{{ project.display_name or project.name or 'App' }}"
readonly VERSION="{{ project.version }}"
readonly PYTHON_MIN_VERSION="{{ installation.python_version | default('3.8') }}"

# Colors and formatting
readonly RED='\033[0;31m'
readonly GREEN='\033[0;32m'
readonly YELLOW='\033[1;33m'
readonly BLUE='\033[0;34m'
readonly NC='\033[0m'
readonly TREE_BRANCH="├─"
readonly TREE_LAST="└─"

detect_system() {
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        echo "linux"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        echo "macos"
    elif [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "msys" ]]; then
        echo "windows"
    else
        echo "unknown"
    fi
}

validate_python() {
    if ! command -v python3 >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} Python 3 not found. Please install Python $PYTHON_MIN_VERSION or later."
        return 1
    fi
    
    local python_version=$(python3 --version 2>&1 | cut -d' ' -f2)
    echo -e "${GREEN}✓${NC} Found Python $python_version"
    return 0
}

install_dependencies() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Installing system dependencies..."
    
    local system=$(detect_system)
{%- if installation.extras and installation.extras.apt %}
    if [[ "$system" == "linux" ]] && command -v apt >/dev/null 2>&1; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing APT packages..."
        sudo apt update -qq
        sudo apt install -y {{ installation.extras.apt | join(' ') }}
    fi
{%- endif %}

{%- if installation.extras and installation.extras.brew %}
    if [[ "$system" == "macos" ]] && command -v brew >/dev/null 2>&1; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing Homebrew packages..."
        brew install {{ installation.extras.brew | join(' ') }}
    fi
{%- endif %}
}

install_package() {
    local dev_mode="$1"
    
    echo -e "${BLUE}$TREE_BRANCH${NC} Installing Python package..."
    
    if command -v pipx >/dev/null 2>&1 && [[ "$dev_mode" != "true" ]]; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Using pipx for isolated installation..."
        pipx install "$PACKAGE_NAME"
    elif [[ "$dev_mode" == "true" ]]; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing in development mode..."
        pip install -e ".[dev]"
    else
        echo -e "${BLUE}  $TREE_BRANCH${NC} Using pip..."
        pip install --user "$PACKAGE_NAME"
    fi
    
    echo -e "${GREEN}✓${NC} Installation completed successfully!"
    return 0
}

upgrade_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Upgrading package..."
    
    if command -v pipx >/dev/null 2>&1; then
        pipx upgrade "$PACKAGE_NAME"
    else
        pip install --upgrade --user "$PACKAGE_NAME"
    fi
    
    echo -e "${GREEN}✓${NC} Upgrade completed successfully!"
}

uninstall_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Uninstalling package..."
    
    if command -v pipx >/dev/null 2>&1; then
        pipx uninstall "$PACKAGE_NAME"
    else
        pip uninstall -y "$PACKAGE_NAME"
    fi
    
    echo -e "${GREEN}✓${NC} Uninstall completed successfully!"
}

main() {
    local command="${1:-install}"
    local dev_flag="false"
    
    # Parse arguments
    while [[ $# -gt 0 ]]; do
        case $1 in
            install|upgrade|uninstall|validate)
                command="$1"
                ;;
            --dev)
                dev_flag="true"
                ;;
            *)
                echo "Usage: $0 {install|upgrade|uninstall|validate} [--dev]"
                exit 1
                ;;
        esac
        shift
    done
    
    echo
    echo "$DISPLAY_NAME Setup v$VERSION"
    echo "$TREE_LAST $command Process"
    
    case "$command" in
        install)
            validate_python || exit 1
            install_dependencies
            install_package "$dev_flag"
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        upgrade)
            validate_python || exit 1
            upgrade_package
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        uninstall)
            uninstall_package
            ;;
        validate)
            validate_python || exit 1
            echo -e "${GREEN}✓${NC} System validation passed!"
            ;;
    esac
}

main "$@"

{%- elif language == 'nodejs' -%}
#!/bin/bash
# ============================================================================
# AUTO-GENERATED FILE - DO NOT EDIT  
# Generated by Goobits CLI Framework using Universal Templates
# To regenerate this file, run: goobits build --universal-templates
# ============================================================================

set -e

# Core configuration
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly PACKAGE_NAME="{{ project.name | lower | replace(' ', '-') }}"
readonly COMMAND_NAME="{{ (project.name or 'app') | lower | replace(' ', '-') }}"
readonly DISPLAY_NAME="{{ project.display_name or project.name or 'App' }}"
readonly VERSION="{{ project.version }}"
readonly NODE_MIN_VERSION="{{ installation.node_version | default('14.0.0') }}"

# Colors and formatting
readonly GREEN='\033[0;32m'
readonly RED='\033[0;31m'
readonly BLUE='\033[0;34m'
readonly NC='\033[0m'
readonly TREE_BRANCH="├─"
readonly TREE_LAST="└─"

validate_node() {
    if ! command -v node >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} Node.js not found. Please install Node.js $NODE_MIN_VERSION or later."
        return 1
    fi
    
    local node_version=$(node --version | sed 's/v//')
    echo -e "${GREEN}✓${NC} Found Node.js $node_version"
    return 0
}

install_package() {
    local dev_mode="$1"
    
    echo -e "${BLUE}$TREE_BRANCH${NC} Installing Node.js package..."
    
    if [[ "$dev_mode" == "true" ]]; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing in development mode..."
        npm install
        npm link
    else
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing globally..."
        npm install -g .
    fi
    
    echo -e "${GREEN}✓${NC} Installation completed successfully!"
    return 0
}

upgrade_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Upgrading package..."
    npm update -g "$PACKAGE_NAME"
    echo -e "${GREEN}✓${NC} Upgrade completed successfully!"
}

uninstall_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Uninstalling package..."
    npm uninstall -g "$PACKAGE_NAME"
    echo -e "${GREEN}✓${NC} Uninstall completed successfully!"
}

main() {
    local command="${1:-install}"
    local dev_flag="false"
    
    # Parse arguments
    while [[ $# -gt 0 ]]; do
        case $1 in
            install|upgrade|uninstall|validate)
                command="$1"
                ;;
            --dev)
                dev_flag="true"
                ;;
            *)
                echo "Usage: $0 {install|upgrade|uninstall|validate} [--dev]"
                exit 1
                ;;
        esac
        shift
    done
    
    echo
    echo "$DISPLAY_NAME Setup v$VERSION"
    echo "$TREE_LAST $command Process"
    
    case "$command" in
        install)
            validate_node || exit 1
            install_package "$dev_flag"
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        upgrade)
            validate_node || exit 1
            upgrade_package
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        uninstall)
            uninstall_package
            ;;
        validate)
            validate_node || exit 1
            echo -e "${GREEN}✓${NC} System validation passed!"
            ;;
    esac
}

main "$@"

{%- elif language == 'typescript' -%}
#!/bin/bash
# ============================================================================
# AUTO-GENERATED FILE - DO NOT EDIT
# Generated by Goobits CLI Framework using Universal Templates
# To regenerate this file, run: goobits build --universal-templates  
# ============================================================================

set -e

# Core configuration
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly PACKAGE_NAME="{{ project.name | lower | replace(' ', '-') }}"
readonly COMMAND_NAME="{{ (project.name or 'app') | lower | replace(' ', '-') }}"
readonly DISPLAY_NAME="{{ project.display_name or project.name or 'App' }}"
readonly VERSION="{{ project.version }}"
readonly NODE_MIN_VERSION="{{ installation.node_version | default('14.0.0') }}"

# Colors and formatting
readonly GREEN='\033[0;32m'
readonly RED='\033[0;31m'
readonly BLUE='\033[0;34m'
readonly NC='\033[0m'
readonly TREE_BRANCH="├─"
readonly TREE_LAST="└─"

validate_node() {
    if ! command -v node >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} Node.js not found. Please install Node.js $NODE_MIN_VERSION or later."
        return 1
    fi
    
    if ! command -v npm >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} npm not found. Please install npm."
        return 1
    fi
    
    local node_version=$(node --version | sed 's/v//')
    echo -e "${GREEN}✓${NC} Found Node.js $node_version"
    return 0
}

build_package() {
    echo -e "${BLUE}  $TREE_BRANCH${NC} Building TypeScript..."
    npm run build
}

install_package() {
    local dev_mode="$1"
    
    echo -e "${BLUE}$TREE_BRANCH${NC} Installing TypeScript package..."
    
    if [[ "$dev_mode" == "true" ]]; then
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing dependencies..."
        npm install
        build_package
        echo -e "${BLUE}  $TREE_BRANCH${NC} Linking for development..."
        npm link
    else
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing dependencies..."
        npm install --only=production
        build_package
        echo -e "${BLUE}  $TREE_BRANCH${NC} Installing globally..."
        npm link
    fi
    
    echo -e "${GREEN}✓${NC} Installation completed successfully!"
    return 0
}

upgrade_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Upgrading package..."
    npm update -g "$PACKAGE_NAME"
    echo -e "${GREEN}✓${NC} Upgrade completed successfully!"
}

uninstall_package() {
    echo -e "${BLUE}$TREE_BRANCH${NC} Uninstalling package..."
    npm uninstall -g "$PACKAGE_NAME"
    echo -e "${GREEN}✓${NC} Uninstall completed successfully!"
}

main() {
    local command="${1:-install}"
    local dev_flag="false"
    
    # Parse arguments
    while [[ $# -gt 0 ]]; do
        case $1 in
            install|upgrade|uninstall|validate)
                command="$1"
                ;;
            --dev)
                dev_flag="true"
                ;;
            *)
                echo "Usage: $0 {install|upgrade|uninstall|validate} [--dev]"
                exit 1
                ;;
        esac
        shift
    done
    
    echo
    echo "$DISPLAY_NAME Setup v$VERSION"
    echo "$TREE_LAST $command Process"
    
    case "$command" in
        install)
            validate_node || exit 1
            install_package "$dev_flag"
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        upgrade)
            validate_node || exit 1
            upgrade_package
            echo "        └─ Try: $COMMAND_NAME --version"
            ;;
        uninstall)
            uninstall_package
            ;;
        validate)
            validate_node || exit 1
            echo -e "${GREEN}✓${NC} System validation passed!"
            ;;
    esac
}

main "$@"

{%- endif -%}