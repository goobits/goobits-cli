//! ╔══════════════════════════════════════════════════════════════════════════╗
//! ║                           AUTO-GENERATED FILE                               ║
//! ║                                                                              ║
//! ║  Generated by: goobits-cli v1.0.0                                       ║
//! ║  Generated from: nested-command-demo.yaml                 ║
//! ║  Generated on: 2025-08-24 15:17:43               ║
//! ║                                                                              ║
//! ║  ⚠️  DO NOT EDIT THIS FILE MANUALLY                                         ║
//! ║  Changes will be overwritten on next generation                             ║
//! ║                                                                              ║
//! ║  To modify this CLI, edit the source configuration file                     ║
//! ║                                                                              ║
//! ╚══════════════════════════════════════════════════════════════════════════╝
//!
//! demo CLI - Rust Implementation
//! Generated from nested-command-demo.yaml



use clap::{Arg, ArgMatches, Command};

use std::process;

use anyhow::Result;



mod hooks;



fn main() {

    let app = Command::new("demo")

        .about("A CLI tool")

        .version("1.0.0")

        .subcommand_required(false)

        .arg_required_else_help(true)

        // Add global options

        .arg(Arg::new("verbose")

            .short('v')

            .long("verbose")

            .help("Enable verbose output")

            .action(clap::ArgAction::SetTrue)

            .global(true))

        .arg(Arg::new("config")

            .short('c')

            .long("config")

            .help("Config file path")

            .value_name("PATH")

            .global(true));

    

    let app = build_cli(app);

    let matches = app.get_matches();

    

    if let Err(e) = handle_command(&matches) {

        eprintln!("Error: {}", e);

        process::exit(1);

    }

}



fn build_cli(app: Command) -> Command {

    let mut app = app;

    

    // Add commands from configuration

    app = app.subcommand(
        Command::new("simple")
            .about("Simple command that works today")
            .arg(Arg::new("message")
                .help("Message to display")
                .required(true)
                .value_name("MESSAGE"))
            .arg(Arg::new("verbose")
                .help("Verbose output")
                
                .long("verbose")
                .action(clap::ArgAction::SetTrue))
    );
app = app.subcommand(
        Command::new("database")
            .about("Database operations")
            .subcommand_required(true)
            .arg_required_else_help(true)
            .subcommand(
                Command::new("users")
                    .about("User management")
                    .arg(Arg::new("action")
                        .help("Action to perform")
                        .required(true)
                        .value_name("ACTION"))
                    .arg(Arg::new("format")
                        .help("Output format")
                        
                        .long("format")
                        .value_name("VALUE"))
            )
            .subcommand(
                Command::new("backup")
                    .about("Database backup operations")
                    .arg(Arg::new("compress")
                        .help("Compress backup file")
                        
                        .long("compress")
                        .action(clap::ArgAction::SetTrue))
            )
    );
app = app.subcommand(
        Command::new("api")
            .about("API management")
            .subcommand_required(true)
            .arg_required_else_help(true)
            .subcommand(
                Command::new("v1")
                    .about("API v1 endpoints")
            .subcommand(
                Command::new("users")
                    .about("User API endpoints")
            .subcommand(
                Command::new("create")
                    .about("Create user via API")
                    .arg(Arg::new("username")
                        .help("Username for new user")
                        .required(true)
                        .value_name("USERNAME"))
                    .arg(Arg::new("email")
                        .help("User email address")
                        .required(true)
                        .value_name("EMAIL"))
                    .arg(Arg::new("admin")
                        .help("Create as admin user")
                        
                        .long("admin")
                        .action(clap::ArgAction::SetTrue))
                    .arg(Arg::new("send-email")
                        .help("Send welcome email")
                        
                        .long("send-email")
                        .action(clap::ArgAction::SetTrue))
            )
            .subcommand(
                Command::new("permissions")
                    .about("Manage user permissions")
            .subcommand(
                Command::new("grant")
                    .about("Grant permission to user")
                    .arg(Arg::new("user_id")
                        .help("User ID")
                        .required(true)
                        .value_name("USER_ID"))
                    .arg(Arg::new("permission")
                        .help("Permission name")
                        .required(true)
                        .value_name("PERMISSION"))
                    .arg(Arg::new("expires")
                        .help("Permission expiration")
                        
                        .long("expires")
                        .value_name("VALUE"))
            )
            .subcommand(
                Command::new("revoke")
                    .about("Revoke permission from user")
                    .arg(Arg::new("user_id")
                        .help("User ID")
                        .required(true)
                        .value_name("USER_ID"))
                    .arg(Arg::new("permission")
                        .help("Permission name")
                        .required(true)
                        .value_name("PERMISSION"))
                    .arg(Arg::new("force")
                        .help("Force revocation")
                        
                        .long("force")
                        .action(clap::ArgAction::SetTrue))
            )
            )
            )
            )
    );

    

    app

}



fn handle_command(matches: &ArgMatches) -> Result<()> {

    match matches.subcommand() {

        Some(("simple", sub_matches)) => {
            let message = sub_matches.get_one::<String>("message").map(|s| s.as_str()).unwrap_or("");
                let opt_verbose = sub_matches.get_flag("verbose");
                let global_verbose = sub_matches.get_flag("verbose");
                let config: Option<&str> = sub_matches.get_one::<String>("config").map(|s| s.as_str());
            if let Err(e) = hooks::on_simple(message, opt_verbose, global_verbose, config) {
                eprintln!("Error: {}", e);
                std::process::exit(1);
            }
            Ok(())
        }
        Some(("database", sub_matches)) => {
            match sub_matches.subcommand() {
                Some(("users", sub_sub_matches)) => {
                let action = sub_sub_matches.get_one::<String>("action").map(|s| s.as_str()).unwrap_or("");
                let format: Option<&str> = sub_sub_matches.get_one::<String>("format").map(|s| s.as_str());
                let verbose = sub_sub_matches.get_flag("verbose");
                let config: Option<&str> = sub_sub_matches.get_one::<String>("config").map(|s| s.as_str());
                if let Err(e) = hooks::on_database_users(action, format, verbose, config) {
                    eprintln!("Error: {}", e);
                    std::process::exit(1);
                }
                Ok(())
            }
            Some(("backup", sub_sub_matches)) => {
                let compress = sub_sub_matches.get_flag("compress");
                let verbose = sub_sub_matches.get_flag("verbose");
                let config: Option<&str> = sub_sub_matches.get_one::<String>("config").map(|s| s.as_str());
                if let Err(e) = hooks::on_database_backup(compress, verbose, config) {
                    eprintln!("Error: {}", e);
                    std::process::exit(1);
                }
                Ok(())
            }
            _ => {
                eprintln!("Unknown subcommand. Use --help for available options.");
                std::process::exit(1);
            }
            }
        }
        Some(("api", sub_matches)) => {
            match sub_matches.subcommand() {
                Some(("v1", sub_sub_matches)) => {
                let verbose = sub_sub_matches.get_flag("verbose");
                let config: Option<&str> = sub_sub_matches.get_one::<String>("config").map(|s| s.as_str());
                if let Err(e) = hooks::on_api_v1(verbose, config) {
                    eprintln!("Error: {}", e);
                    std::process::exit(1);
                }
                Ok(())
            }
            _ => {
                eprintln!("Unknown subcommand. Use --help for available options.");
                std::process::exit(1);
            }
            }
        }

        _ => {

            println!("No command specified. Use --help for available commands.");

            Ok(())

        }

    }

}

