suite_name: completion-commands
description: Tests for shell completion functionality

setup:
  goobits_config: ../test-cli-config.yaml
  cleanup: true

tests:
  - name: completion_command_exists
    description: Completion command is available
    command: completion --help
    stdout:
      contains:
        - "completion"
        - "Generate shell completion"
        
  - name: completion_bash
    description: Generate bash completion script
    command: completion bash
    stdout:
      contains:
        - "bash"
        - "complete"
        - "test-cli"
    language_overrides:
      rust:
        stdout:
          contains:
            - "_test-cli"
            - "COMPREPLY"
            
  - name: completion_zsh
    description: Generate zsh completion script
    command: completion zsh
    stdout:
      contains:
        - "compdef"
        - "test-cli"
    language_overrides:
      nodejs:
        stdout:
          contains:
            - "#compdef test-cli"
      typescript:
        stdout:
          contains:
            - "#compdef test-cli"
      rust:
        stdout:
          contains:
            - "#compdef test-cli"
            - "_test-cli"
            
  - name: completion_fish
    description: Generate fish completion script
    command: completion fish
    stdout:
      contains:
        - "complete"
        - "test-cli"
    language_overrides:
      rust:
        stdout:
          contains:
            - "complete -c test-cli"
            
  - name: completion_powershell
    description: Generate PowerShell completion script
    command: completion powershell
    stdout:
      contains:
        - "test-cli"
        - "Register-ArgumentCompleter"
    language_overrides:
      nodejs:
        skip: true
        skip_reason: "PowerShell completion not yet implemented in Node.js template"
      typescript:
        skip: true
        skip_reason: "PowerShell completion not yet implemented in TypeScript template"
      rust:
        stdout:
          contains:
            - "param($wordToComplete"
            - "test-cli"
            
  - name: completion_unsupported_shell
    description: Unsupported shell shows error
    command: completion tcsh
    exit_code: 2
    stderr:
      contains:
        - "Invalid choice"
    language_overrides:
      nodejs:
        stderr:
          contains:
            - "error: unknown shell"
      typescript:
        stderr:
          contains:
            - "error: unknown shell"
      rust:
        stderr:
          contains:
            - "invalid value 'tcsh'"
            
  - name: completion_install_help
    description: Completion install subcommand help
    command: completion install --help
    stdout:
      contains:
        - "install"
        - "Install shell completion"
    language_overrides:
      nodejs:
        skip: true
        skip_reason: "Install subcommand not implemented in Node.js template"
      typescript:
        skip: true
        skip_reason: "Install subcommand not implemented in TypeScript template"
      rust:
        skip: true
        skip_reason: "Install subcommand handled differently in Rust"