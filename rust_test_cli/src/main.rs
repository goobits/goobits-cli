//! Generated by goobits-cli

//! 

//! Note: Rust templates are not yet installed.

//! This is a basic CLI structure. To get full functionality,

//! ensure Rust templates are installed in:

//! src/goobits_cli/templates/rust/



use clap::{Arg, ArgMatches, Command};

use std::process;



mod hooks;



fn main() {

    let app = Command::new("testcli")

        .about("A CLI tool")

        .version("0.1.0")

        .subcommand_required(false)

        .arg_required_else_help(true);

    

    let app = build_cli(app);

    let matches = app.get_matches();

    

    if let Err(e) = handle_command(&matches) {

        eprintln!("Error: {}", e);

        process::exit(1);

    }

}



fn build_cli(app: Command) -> Command {

    let mut app = app;

    

    // Add commands from configuration

    app = app.subcommand(

        Command::new("hello")

            .about("Say hello")

            .arg(Arg::new("name")

                .help("Name to greet")

                .required(true)

                .index(1))

            .arg(Arg::new("uppercase")

                .help("Print in uppercase")

                .short('u')

                .long("uppercase").action(clap::ArgAction::SetTrue))

    );
app = app.subcommand(

        Command::new("info")

            .about("Show information")

            .arg(Arg::new("detailed")

                .help("Show detailed information")

                .short('d')

                .long("detailed").action(clap::ArgAction::SetTrue))

    );

    

    app

}



fn handle_command(matches: &ArgMatches) -> anyhow::Result<()> {

    match matches.subcommand() {

        Some(("hello", sub_matches)) => {

            println!("Executing hello command...");

            
            // Try to call hook, but gracefully handle if it doesn't exist
            if let Err(e) = hooks::on_hello(sub_matches) {
                // Check if it's a "function not found" type error
                let error_msg = format!("{:?}", e);
                if error_msg.contains("not implemented") || error_msg.contains("not found") {
                    // Hook not implemented - show placeholder behavior
                    println!("Command 'hello' executed successfully (no custom implementation)");
                    println!("To implement custom behavior, add the 'on_hello' function to src/hooks.rs");
                } else {
                    // Real error - propagate it
                    return Err(e);
                }
            }
            Ok(())

        }
        Some(("info", sub_matches)) => {

            println!("Executing info command...");

            
            // Try to call hook, but gracefully handle if it doesn't exist
            if let Err(e) = hooks::on_info(sub_matches) {
                // Check if it's a "function not found" type error
                let error_msg = format!("{:?}", e);
                if error_msg.contains("not implemented") || error_msg.contains("not found") {
                    // Hook not implemented - show placeholder behavior
                    println!("Command 'info' executed successfully (no custom implementation)");
                    println!("To implement custom behavior, add the 'on_info' function to src/hooks.rs");
                } else {
                    // Real error - propagate it
                    return Err(e);
                }
            }
            Ok(())

        }

        _ => {

            println!("No command specified. Use --help for available commands.");

            Ok(())

        }

    }

}

