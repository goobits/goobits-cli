#!/usr/bin/env python3
"""
Interactive mode for Test CLI
Generated by Goobits CLI Framework
"""

import cmd
import shlex
import sys
from typing import List, Optional
try:
    from .test_cli_cli import cli
    from .hooks import *  # Import all hook functions
except ImportError:
    # Fallback imports
    from test_cli_cli import cli
    try:
        from hooks import *
    except ImportError:
        pass

class TestcliInteractive(cmd.Cmd):
    """Interactive CLI for Test CLI"""
    
    intro = "Welcome to Test CLI interactive mode. Type 'help' for commands, 'exit' to quit."
    prompt = "test-cli> "
    
    def __init__(self):
        super().__init__()
        self.command_history = []
        
    def do_exit(self, arg):
        """Exit the interactive mode"""
        print("Goodbye!")
        return True
        
    def do_quit(self, arg):
        """Exit the interactive mode"""
        return self.do_exit(arg)
        
    def do_EOF(self, arg):
        """Handle Ctrl+D"""
        print()  # New line after ^D
        return True
    
    def do_hello(self, arg):
        """Say hello
        
        Usage: hello NAME [--uppercase|-u]
        
        Arguments:
            NAME: Name to greet
        
        Options:
            --uppercase, -u: Convert to uppercase
        """
        try:
            # Parse arguments
            args = shlex.split(arg)
            
            # Call the hook function if it exists
            hook_name = "on_hello"
            if hook_name in globals():
                hook_func = globals()[hook_name]
                # TODO: Parse args properly and call hook
                hook_func(*args)
            else:
                print(f"Hook function '{hook_name}' not implemented")
        except Exception as e:
            print(f"Error: {e}")
    
    def complete_hello(self, text, line, begidx, endidx):
        """Tab completion for hello command"""
        # Basic completion for options
        options = ["--uppercase", "-u"]
        return [opt for opt in options if opt.startswith(text)]
    
    def default(self, line):
        """Handle unknown commands"""
        print(f"Unknown command: {line.split()[0] if line else ''}")
        print("Type 'help' for available commands")
    
    def emptyline(self):
        """Handle empty line (do nothing instead of repeating last command)"""
        pass
    
    def precmd(self, line):
        """Hook before command execution"""
        if line and not line.startswith('help'):
            self.command_history.append(line)
        return line
    
    def postcmd(self, stop, line):
        """Hook after command execution"""
        return stop

def run_interactive():
    """Launch the interactive mode"""
    try:
        TestcliInteractive().cmdloop()
    except KeyboardInterrupt:
        print("\nInterrupted. Use 'exit' to quit.")
        run_interactive()

if __name__ == "__main__":
    run_interactive()