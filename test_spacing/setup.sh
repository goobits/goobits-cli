#!/bin/bash
# Rust Setup Script
# Generated by Goobits CLI Framework

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

validate_rust() {
    if ! command -v rustc >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} Rust not found. Please install Rust from rustup.rs"
        return 1
    fi
    
    if ! command -v cargo >/dev/null 2>&1; then
        echo -e "${RED}✗${NC} Cargo not found. Please install Cargo"
        return 1
    fi
    
    local rust_version=$(rustc --version)
    echo -e "${GREEN}✓${NC} Found $rust_version"
    return 0
}

build_rust() {
    echo -e "${BLUE}Building Rust project...${NC}"
    cargo build --release
    echo -e "${GREEN}✓ Build completed successfully${NC}"
}

install_package() {
    local from_source="$1"
    
    echo -e "${BLUE}Installing Rust package...${NC}"
    
    if [[ "$from_source" == "true" ]]; then
        build_rust
        cargo install --path .
    else
        cargo install "spacing-test-cli"
    fi
    
    echo -e "${GREEN}✓ Installation completed successfully!${NC}"
}

upgrade_package() {
    echo -e "${BLUE}Upgrading package...${NC}"
    cargo install --force "spacing-test-cli"
    echo -e "${GREEN}✓ Upgrade completed successfully!${NC}"
}

uninstall_package() {
    echo -e "${BLUE}Uninstalling package...${NC}"
    cargo uninstall "spacing-test-cli"
    echo -e "${GREEN}✓ Uninstall completed successfully!${NC}"
}

main() {
    local command="${1:-install}"
    local source_flag="false"
    
    while [[ $# -gt 0 ]]; do
        case $1 in
            install|upgrade|uninstall|validate|build)
                command="$1"
                ;;
            --from-source)
                source_flag="true"
                ;;
            *)
                echo "Usage: $0 {install|upgrade|uninstall|validate|build} [--from-source]"
                exit 1
                ;;
        esac
        shift
    done
    
    case $command in
        validate)
            validate_rust
            ;;
        build)
            validate_rust && build_rust
            ;;
        install)
            validate_rust && install_package "$source_flag"
            ;;
        upgrade)
            validate_rust && upgrade_package
            ;;
        uninstall)
            uninstall_package
            ;;
        *)
            echo "Unknown command: $command"
            exit 1
            ;;
    esac
}

main "$@"